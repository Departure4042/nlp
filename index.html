<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meeting Cost Calculator</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #total-cost {
            font-size: 24px;
            font-weight: bold;
            color: #e44d26;
        }
        .projection, .savings {
            font-size: 18px;
        }
    </style>
</head>
<body>
    <h1>Meeting Cost Calculator</h1>
    
    <label for="employee-select">Select Meeting Attendees:</label>
    <select id="employee-select" style="width: 50%;" multiple="multiple">
        <!-- Employee options will be populated here from the CSV data -->
    </select>
    
    <h2>Total cost of this meeting:</h2>
    <div id="total-cost">$0.00</div>
    
    <h3>Projected Costs:</h3>
    <div class="projection">Cost if 15 minutes: <span id="cost-15min">$0.00</span></div>
    <div class="projection">Cost if 30 minutes: <span id="cost-30min">$0.00</span></div>
    <div class="projection">Cost if 60 minutes: <span id="cost-60min">$0.00</span></div>
    
    <h3>Potential Savings:</h3>
    <div class="savings">If ended 5 minutes early: <span id="save-5min">$0.00</span></div>
    <div class="savings">If ended 10 minutes early: <span id="save-10min">$0.00</span></div>
    <div class="savings">If ended 15 minutes early: <span id="save-15min">$0.00</span></div>
    
    <button id="start-meeting">Start Meeting</button>
    <button id="stop-meeting">Stop Meeting</button>
    <button id="reset-calculator">Reset Calculator</button>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/1.0.21/jquery.csv.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script>
        const employeeSelect = $('#employee-select');
        const totalCostDiv = $('#total-cost');

        let attendees = [];
        let totalCost = 0;
        let costPerMinute = 0;
        let meetingInterval = null;
        let employeeData = [];

        async function loadEmployeeData() {
            try {
                const response = await fetch('napa-2022.csv');
                if (!response.ok) {
                    console.error('Network response was not ok', response);
                    return [];
                }
                const csvText = await response.text();
                employeeData = $.csv.toObjects(csvText);
                return employeeData;
            } catch (error) {
                console.error('Error in fetching and parsing CSV data:', error);
                return [];
            }
        }

        loadEmployeeData().then(employeeData => {
            if (employeeData.length === 0) {
                console.error('No employee data loaded from CSV.');
                return;
            }
            employeeData.forEach((employee, index) => {
                const option = new Option(employee['Employee Name'], index);
                employeeSelect.append(option);
            });
            employeeSelect.select2({
                placeholder: 'Select attendees',
                allowClear: true
            });
        }).catch(error => {
            console.error('Error in loading employee data:', error);
        });

        function updateMeetingCost() {
            totalCost += costPerMinute / 60; // Update cost every second
            totalCostDiv.text(`$${totalCost.toFixed(2)}`);
            
            // Projected costs
            $('#cost-15min').text(`$${(costPerMinute * 15).toFixed(2)}`);
            $('#cost-30min').text(`$${(costPerMinute * 30).toFixed(2)}`);
            $('#cost-60min').text(`$${(costPerMinute * 60).toFixed(2)}`);
            
            // Potential savings
            $('#save-5min').text(`$${(costPerMinute * 5).toFixed(2)}`);
            $('#save-10min').text(`$${(costPerMinute * 10).toFixed(2)}`);
            $('#save-15min').text(`$${(costPerMinute * 15).toFixed(2)}`);
        }

        $('#start-meeting').click(() => {
            const selectedIndices = employeeSelect.val();
            attendees = selectedIndices.map(index => employeeData[parseInt(index)]);
            costPerMinute = attendees.reduce((sum, attendee) => sum + parseFloat(attendee['Base Pay']) / (52 * 40 * 60), 0);
            meetingInterval = setInterval(updateMeetingCost, 1000); // Update every second
        });

        $('#stop-meeting').click(() => {
            clearInterval(meetingInterval);
        });

        $('#reset-calculator').click(() => {
            clearInterval(meetingInterval);
            totalCost = 0;
            costPerMinute = 0;
            attendees = [];
            totalCostDiv.text('$0.00');
            employeeSelect.val(null).trigger('change');
            // Reset projected costs and savings
            $('.projection span, .savings span').text('$0.00');
        });

        totalCostDiv.text('$0.00');
    </script>
</body>
</html>
